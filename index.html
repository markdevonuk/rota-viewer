function doGet(e) {
  const action = e.parameter.action;
  const event = e.parameter.event || "Glastonbury2025"; // Default event if none specified
  
  const ss = SpreadsheetApp.getActiveSpreadsheet();

  if (action === "loadAllShifts") {
    // Format the sheet name based on the event parameter
    // e.g., "Glastonbury2025" becomes "Glastonbury 2025-Shifts"
    const formattedEvent = event.replace(/(\d{4})$/, ' $1');
    const sheetName = `${formattedEvent}-Shifts`;
    
    const sheet = ss.getSheetByName(sheetName);
    
    if (!sheet) {
      return ContentService
        .createTextOutput(JSON.stringify({ error: `Event sheet "${sheetName}" not found` }))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
    const data = sheet.getDataRange().getDisplayValues();
    const headers = data[0];
    const rows = data.slice(1).map(row => {
      const obj = {};
      headers.forEach((header, i) => {
        obj[header] = row[i];
      });
      return obj;
    });
    
    return ContentService
      .createTextOutput(JSON.stringify(rows))
      .setMimeType(ContentService.MimeType.JSON);
  }
  
  return ContentService.createTextOutput("Missing or invalid 'action' parameter");
}
